(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function r(e,o,r,c,a,u,i,l){var s=document.getElementById("card-template").content.querySelector(".places__item").cloneNode(!0),d=s.querySelector(".card__image");d.src=e.link,d.alt=e.name,s.querySelector(".card__title").textContent=e.name;var p=s.querySelector(".card__delete-button");c!==a&&p.remove(),p.addEventListener("click",(function(){t(document.querySelector(".popup_type_delete")),document.querySelector(".popup__ok").addEventListener("click",(function(){o(e._id),s.remove(),n(document.querySelector(".popup_type_delete"))}))}));var f=s.querySelector(".card__like-button"),m=s.querySelector(".card__like-text");return m.textContent=e.likes.length,0===e.likes.length&&(m.textContent=null),f.addEventListener("click",(function(t){u(t.target,s.querySelector(".card__like-text"),e)})),e.likes.forEach((function(e){e._id==c&&f.classList.add("card__like-button_is-active")})),s.querySelector(".card__image").addEventListener("click",(function(e){r(e.target)})),s}e.d({},{DF:()=>x,ie:()=>_,Uh:()=>y,ld:()=>L,sv:()=>E});var c=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_error"),n.classList.remove("popup__input-error_active"),n.textContent=""},a=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0},u=function(){Array.from(document.querySelectorAll("form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");a(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?c(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_error"),o.classList.add("popup__input-error_active"),o.textContent=n}(e,t,t.validationMessage)}(e,o),a(t,n)}))}))}(e)}))},i={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-24",headers:{authorization:"8921ad05-b64f-4b7a-874c-7de7db1761f7","Content-Type":"application/json"}},l=function(){return fetch("".concat(i.baseUrl,"/users/me"),{method:"GET",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Данные пользователя не загрузились: ".concat(e.status))}))},s=function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers})};function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var p=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),m=document.forms["edit-profile"],_=m.elements.name,y=m.elements.description,v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__image"),k=document.querySelector(".popup__button"),q=document.forms["new-place"],E=q.elements["place-name"],L=q.elements.link,C=document.forms["new-avatar"],x=C.elements.formAvatar,j=document.querySelectorAll(".popup"),w="",A=[l(),fetch("".concat(i.baseUrl,"/cards"),{method:"GET",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Карточки не загрузились: ".concat(e.status))}))];Promise.all(A).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];w=c._id,U(c),function(e,t){for(var n=0;n<e.length;n++)p.append(r(e[n],s,O,t,e[n].owner._id,P))}(a,w)})).catch((function(e){console.log("Ошибка. Promise.all не загрузился",e)}));var P=function(e,t,n){var o;!function(e){e.classList.toggle("card__like-button_is-active")}(e),e.classList.contains("card__like-button_is-active")?(o=n._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Карточки не загрузились: ".concat(e.status))}))).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log("Лайк не добавлен ".concat(e))})):function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Карточки не загрузились: ".concat(e.status))}))}(n._id).then((function(e){t.textContent=e.likes.length,0===e.likes.length&&(t.textContent=null)})).catch((function(e){console.log("Лайк не удалился ".concat(e))}))};function U(e){v.textContent=e.name,h.textContent=e.about,g.style.backgroundImage="url(".concat(e.avatar,")")}function O(e){t(document.querySelector(".popup_type_image"));var n=document.querySelector(".popup__image");n.src=e.src,n.alt=e.alt,document.querySelector(".popup__caption").textContent=n.alt}u(),g.addEventListener("click",(function(){var e;t(document.querySelector(".popup_type_new-avatar")),(e=C).reset(),c(e,x),u()})),C.addEventListener("submit",(function(e){e.preventDefault();var t={avatar:x.value};k.textContent="Сохранение...",function(e){try{return fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify(e)})}catch(e){console.log(e)}}(t).then((function(){l().then((function(e){U(e)}))})).finally((function(){k.textContent="Сохранить"})),n(document.querySelector(".popup_type_new-avatar"))})),f.addEventListener("click",(function(){var e;t(S),l().then((function(e){_.value=e.name,y.value=e.about})).catch((function(e){console.log("Ошибка. Запрос не выполнен",e)})),c(e=m,_),c(e,y),u()})),b.addEventListener("click",(function(){var e;t(document.querySelector(".popup_type_new-card")),(e=q).reset(),c(e,E),c(e,L),u()})),j.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){n(e)}))})),j.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&n(e)}))})),m.addEventListener("submit",(function(e){e.preventDefault();var t,o={name:_.value,about:y.value};k.textContent="Сохранение...",(t=o,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify(t)})).then((function(){var e,t;e=_.value,t=y.value,v.textContent=e,h.textContent=t})).finally((function(){k.textContent="Сохранить"})),n(S)})),q.addEventListener("submit",(function(e){e.preventDefault();var t={name:E.value,link:L.value};k.textContent="Сохранение...",function(e){return fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify(e)})}(t).then((function(e){return e.json()})).then((function(e){return p.prepend(r(e,s,O,w,e.owner._id,P))})).finally((function(){k.textContent="Сохранить"})),n(document.querySelector(".popup_type_new-card"))}))})();